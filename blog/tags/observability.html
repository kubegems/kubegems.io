<!doctype html>
<html lang="zh-CN" dir="ltr" class="blog-wrapper blog-tags-post-list-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.18">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="KubeGems RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="KubeGems Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XB3JTSLM8D"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-XB3JTSLM8D",{anonymize_ip:!0})</script><title data-rh="true">One post tagged with &quot;observability&quot; | KubeGems</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://kubegems.io/blog/tags/observability"><meta data-rh="true" name="docusaurus_locale" content="zh-CN"><meta data-rh="true" name="docsearch:language" content="zh-CN"><meta data-rh="true" name="go-import" content="kubegems.io/kubegems git https://github.com/kubegems/kubegems"><meta data-rh="true" name="go-import" content="kubegems.io/bundle-controller git https://github.com/kubegems/bundle-controller"><meta data-rh="true" name="go-import" content="kubegems.io/configer git https://github.com/kubegems/configer"><meta data-rh="true" name="go-import" content="kubegems.io/ingress-nginx-operator git https://github.com/kubegems/ingress-nginx-operator"><meta data-rh="true" name="go-source" content="kubegems.io/kubegems https://github.com/kubegems/kubegems https://github.com/kubegems/kubegems/tree/master{/dir} https://github.com/kubegems/kubegems/blob/master{/dir}/{file}#L{line}"><meta data-rh="true" name="go-source" content="kubegems.io/bundle-controller https://github.com/kubegems/bundle-controller https://github.com/kubegems/bundle-controller/tree/master{/dir} https://github.com/kubegems/bundle-controller/blob/master{/dir}/{file}#L{line}"><meta data-rh="true" name="go-source" content="kubegems.io/configer https://github.com/kubegems/configer https://github.com/kubegems/configer/tree/master{/dir} https://github.com/kubegems/configer/blob/master{/dir}/{file}#L{line}"><meta data-rh="true" name="go-source" content="kubegems.io/ingress-nginx-operator https://github.com/kubegems/ingress-nginx-operator https://github.com/kubegems/ingress-nginx-operator/tree/master{/dir} https://github.com/kubegems/ingress-nginx-operator/blob/master{/dir}/{file}#L{line}"><meta data-rh="true" property="og:title" content="One post tagged with &quot;observability&quot; | KubeGems"><meta data-rh="true" name="docusaurus_tag" content="blog_tags_posts"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_tags_posts"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://kubegems.io/blog/tags/observability"><link data-rh="true" rel="alternate" href="https://kubegems.io/blog/tags/observability" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://kubegems.io/blog/tags/observability" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.9d5d6358.css">
<link rel="preload" href="/assets/js/runtime~main.359836ee.js" as="script">
<link rel="preload" href="/assets/js/main.d0ddff40.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><div class="announcementBar_IbjG" style="background-color:rgba(0, 0, 0, 0.03)" role="banner"><div class="announcementBarContent_KsVm">â­ï¸ <b>If you like KubeGems, <a target="_blank" href="https://github.com/kubegems/kubegems">give it a star on GitHub</a></b> ! </div></div><nav class="navbar navbar--fixed-top navbarHideable_VLjY"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="KubeGems" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/logo.svg" alt="KubeGems" class="themedImage_W2Cr themedImage--dark_oUvU"></div></a><a class="navbar__item navbar__link" href="/docs/concepts/what-is-kubegems">æ–‡æ¡£</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">åšå®¢</a><a class="navbar__item navbar__link" href="/community/support">ç¤¾ç¾¤</a><a href="https://wj.qq.com/s2/10923500/96e0/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Contact</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/concepts/what-is-kubegems">v1.22</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><span><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_dNtB"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg><span>ç®€ä½“ä¸­æ–‡</span></span></a><ul class="dropdown__menu"><li><a href="/blog/tags/observability" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active">ç®€ä½“ä¸­æ–‡</a></li></ul></div><div class="navbar__items navbar__item--dock"><div class="toggle navbar__dark toggle--disabled" role="button" tabindex="-1"><div class="toggle__icon toggle__icon--unchecked kubegems-icon icon-light"></div><div class="toggle__icon toggle__icon--checked kubegems-icon icon-dark"></div><input type="checkbox" class="toggle__screenreader-only" aria-label="Switch between dark and light mode"></div><a href="https://github.com/kubegems" target="_blank" rel="noopener noreferrer" class="navbar__github"></a><a href="https://demo.kubegems.io" target="_blank" rel="noopener noreferrer" class="navbar__login button button--primary">ä½“éªŒ Demo</a><div class="navbar__login__account"><div class="navbar__login__info">è´¦å·: admin</div><div class="navbar__login__info">å¯†ç : demo!@#admin</div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_a9qW thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_uKok margin-bottom--md">æœ€æ–°åšå®¢</div><ul class="sidebarItemList_Kvuv"><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/kubegems-modelx">ModelXä¸€æ¬¾å¼€æºçš„æœºå™¨å­¦ä¹ æ¨¡å‹ç®¡ç†ä»“åº“</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/kubegems-nacos">KubeGems å¯ç”¨ Nacos é…ç½®ä¸­å¿ƒ</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/kubegems-kind">ä½¿ç”¨ Kind å¿«é€Ÿéƒ¨ç½²ä½“éªŒ KubeGems</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/kubegems-skywalking">åŸºäºKubeGemså¯è§†åŒ–æ­å»ºSkyWalking</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/kubegems-logging">KubeGems ä¸­çš„æ—¥å¿—è®¾è®¡</a></li><li class="sidebarItem_CF0Q"><a class="sidebarItemLink_miNk" href="/blog/kubegems-auth">KubeGems ç”¨æˆ·è®¤è¯å’Œç™»å½•è®¾è®¡</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><header class="margin-bottom--xl"><h1>One post tagged with &quot;observability&quot;</h1><a href="/blog/tags">View All Tags</a></header><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/blog/kubegems-skywalking">åŸºäºKubeGemså¯è§†åŒ–æ­å»ºSkyWalking</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2022-06-23T00:00:00.000Z" itemprop="datePublished">2022å¹´6æœˆ23æ—¥</time> Â· <!-- -->One min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><span class="avatar__photo-link avatar__photo"><a href="https://github.com/liutao-east" target="_blank" rel="noopener noreferrer"><img class="image_o0gy" src="https://github.com/liutao-east.png" alt="liutao"></a></span><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/liutao-east" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">liutao</span></a></div><small class="avatar__subtitle" itemprop="description">contributor@kubegems.io</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p><a href="https://github.com/apache/incubator-skywalking" target="_blank" rel="noopener noreferrer">Apache Skywalking</a> ä¸“é—¨ä¸ºå¾®æœåŠ¡æ¶æ„å’Œäº‘åŸç”Ÿæ¶æ„ç³»ç»Ÿè€Œè®¾è®¡å¹¶ä¸”æ”¯æŒåˆ†å¸ƒå¼é“¾è·¯è¿½è¸ªçš„APMç³»ç»Ÿã€‚<a href="https://github.com/apache/incubator-skywalking" target="_blank" rel="noopener noreferrer">Apache Skywalking</a> é€šè¿‡åŠ è½½æ¢é’ˆçš„æ–¹å¼æ”¶é›†åº”ç”¨è°ƒç”¨é“¾è·¯ä¿¡æ¯ï¼Œå¹¶å¯¹é‡‡é›†çš„è°ƒç”¨é“¾è·¯ä¿¡æ¯è¿›è¡Œåˆ†æï¼Œç”Ÿæˆåº”ç”¨é—´å…³ç³»å’ŒæœåŠ¡é—´å…³ç³»ä»¥åŠæœåŠ¡æŒ‡æ ‡ã€‚<a href="https://github.com/apache/incubator-skywalking" target="_blank" rel="noopener noreferrer">Apache Skywalking</a> ç›®å‰æ”¯æŒå¤šç§è¯­è¨€ï¼Œå…¶ä¸­åŒ…æ‹¬ <a href="https://github.com/apache/incubator-skywalking" target="_blank" rel="noopener noreferrer">Java</a>ï¼Œ<a href="https://github.com/OpenSkywalking/skywalking-netcore" target="_blank" rel="noopener noreferrer">.Net Core</a>ï¼Œ<a href="https://github.com/OpenSkywalking/skywalking-nodejs" target="_blank" rel="noopener noreferrer">Node.js</a> å’Œ <a href="https://github.com/OpenSkywalking/skywalking-go" target="_blank" rel="noopener noreferrer">Go</a> è¯­è¨€ã€‚æœ¬æ–‡å°†ä»ä»¥ KubeGems åº”ç”¨å•†åº—å‡ºå‘ï¼Œæ¥å¿«é€Ÿæ­å»ºä¸€å¥—Skywalkingï¼Œå¸Œæœ›èƒ½å¤Ÿå¸®åŠ©åˆ°å¤§å®¶ã€‚</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="å®‰è£…skywalking-oap">å®‰è£…SkyWalking OAP<a class="hash-link" href="#å®‰è£…skywalking-oap" title="Direct link to heading">â€‹</a></h2><blockquote><p>KubeGemsåº”ç”¨å•†åº—(HelmChart)æ˜¯ä¸€ä¸ªæè¿°Kubernetesç›¸å…³èµ„æºçš„æ–‡ä»¶é›†åˆï¼Œå•ä¸ªåº”ç”¨å¯ä»¥ç”¨æ¥éƒ¨ç½²æŸäº›å¤æ‚çš„HTTPæœåŠ¡å™¨ä»¥åŠWebå…¨æ ˆåº”ç”¨ã€æ•°æ®åº“ã€ç¼“å­˜ç­‰</p></blockquote><ol><li><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="elasticsearchå®‰è£…">Elasticsearchå®‰è£…<a class="hash-link" href="#elasticsearchå®‰è£…" title="Direct link to heading">â€‹</a></h3></li></ol><p>åœ¨KubeGemsåº”ç”¨å•†åº—ä¸­æ‰¾åˆ°Elasticsearch</p><p><img loading="lazy" src="https://img-blog.csdnimg.cn/img_convert/12ad60c8cc85f5045a1ee8a8f445261d.png" class="img_E7b_"></p><p>é€‰æ‹©éƒ¨ç½²7.13.2ç‰ˆæœ¬ï¼Œå¡«å†™å¿…è¦çš„ã€é¡¹ç›®ã€‘ã€ã€ç¯å¢ƒã€‘ç­‰ä¿¡æ¯</p><p><img loading="lazy" src="https://img-blog.csdnimg.cn/img_convert/223d171147da56a82cb509968568f858.png" alt="img" class="img_E7b_"></p><p>ä¸ºæ–¹ä¾¿æ¼”ç¤ºï¼ŒMasterã€ESå‰¯æœ¬æ•°éƒ½é…ç½®ä¸º1ï¼Œå¯æ ¹æ®å®é™…éœ€è¦é…ç½®å‚æ•°ï¼Œè¿˜å¯ä»¥ä¿®æ”¹ <code>Values</code> ä¸­çš„é…ç½®</p><p>SkyWalking åˆå§‹åŒ– ElasticSearch index çš„æ˜¯é»˜è®¤è§„åˆ™æ˜¯ 1 å‰¯æœ¬ 1 åˆ†ç‰‡ï¼Œå®é™…åœ¨ä½¿ç”¨ä¸­ElasticSearch çš„å®ä¾‹æ•°æœ€å¥½å¤§äº 2 ä¸ª</p><p><img loading="lazy" src="https://img-blog.csdnimg.cn/img_convert/ab6bec19080bfa2eaf357c5aa5adee8b.png" alt="img" class="img_E7b_"></p><p>ç‚¹å‡»éƒ¨ç½²ï¼ŒESæœåŠ¡æ­å»ºå®Œæˆã€‚</p><p><img loading="lazy" src="https://img-blog.csdnimg.cn/img_convert/5732a57c4733b7001c28dbee0cec1bf9.png" alt="img" class="img_E7b_"></p><ol><li><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="skywalkingå®‰è£…">SkyWalkingå®‰è£…<a class="hash-link" href="#skywalkingå®‰è£…" title="Direct link to heading">â€‹</a></h3></li></ol><p>åŒæ ·åœ¨åº”ç”¨å•†åº—æ‰¾åˆ°skywalkingåº”ç”¨ï¼Œå¡«å†™åŸºæœ¬ä¿¡æ¯ï¼Œè¿›å…¥è¯¦ç»†é…ç½®é¡µï¼Œå°†æ•°æ®è®¾ç½®ä¸ºESåº”ç”¨åç§°ä¸ç«¯å£</p><p><img loading="lazy" src="https://img-blog.csdnimg.cn/img_convert/f8c24482817f6d19af4db47e08b06544.png" alt="img" class="img_E7b_"></p><p>ç‚¹å‡»éƒ¨ç½²ï¼Œå¯ä»¥çœ‹åˆ°skywalking-oapã€skywalking-uiæœåŠ¡å·²ç»éƒ¨ç½²å®Œæˆ</p><p><img loading="lazy" src="https://img-blog.csdnimg.cn/img_convert/a0bde3d10539ffb239e0772921c84f85.png" alt="img" class="img_E7b_"></p><p>åœ¨KubeGemsæ§åˆ¶å°ï¼Œæ‰¾åˆ°å®¹å™¨æœåŠ¡--&gt;è¿è¡Œæ—¶--&gt;è·¯ç”±ï¼Œåˆ›å»ºè·¯ç”±ï¼Œå°†skywalking-uiæœåŠ¡åœ°å€è¿›è¡ŒåŸŸåæ˜ å°„ã€‚æˆ‘è¿™é‡Œç›´æ¥é‡‡ç”¨éšæœºåŸŸåï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®è‡ªå·±å…¬å¸å†…çš„åŸŸåæ‰‹åŠ¨é…ç½®ã€‚</p><p><img loading="lazy" src="https://img-blog.csdnimg.cn/img_convert/4ea6c436becd2f6c9e6ec6d0f16c5d78.png" alt="img" class="img_E7b_"></p><p>åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€è·¯ç”±è®¿é—®åœ°å€ï¼Œå·²ç»èƒ½æ­£å¸¸çœ‹skywalking-uiçš„é¡µé¢äº†</p><p><img loading="lazy" src="https://img-blog.csdnimg.cn/img_convert/5c93cd6a4ac9c193f61edb3c92b156db.png" alt="img" class="img_E7b_"></p><p><img loading="lazy" src="https://img-blog.csdnimg.cn/img_convert/212b4f67b1839059813b35704ff9ad0c.png" alt="img" class="img_E7b_"></p><p>skywalkingæœåŠ¡æ­å»ºå®Œæˆå•¦ï¼Œæ˜¯ä¸æ˜¯éå¸¸çš„å¿«é€Ÿæ–¹ä¾¿ï¼Œå“ˆå“ˆå“ˆå“ˆå“ˆğŸ˜„</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="skywalking-agent">SkyWalking Agent<a class="hash-link" href="#skywalking-agent" title="Direct link to heading">â€‹</a></h2><blockquote><p>æ‰€è°“Agentæ˜¯æŒ‡SkyWalkingä»å„ä¸ªå¹³å°(Java Pythonç­‰)æ”¶é›†ç›‘æ§æ•°æ®çš„ä»£ç†ï¼Œæ­¤å¤„æˆ‘ä»¬ä»¥ä¸ºJavaåº”ç”¨ä¸ºä¾‹ï¼Œæ”¶é›†Javaåº”ç”¨äº§ç”Ÿçš„å„ç§ç›‘æ§æ•°æ®</p></blockquote><p>SkyWalkingçš„æ•°æ®é‡‡é›†ä¸»è¦æ˜¯é€šè¿‡<strong>ä¸šåŠ¡æ¢é’ˆ(Agent)</strong>æ¥å®ç°çš„ï¼Œé’ˆå¯¹ä¸åŒçš„ç¼–ç¨‹è¯­è¨€SkyWalkingæä¾›äº†å¯¹åº”çš„Agentå®ç°ã€‚Javaå¾®æœåŠ¡æ¥å…¥SkyWalkingå¯ä»¥ä½¿ç”¨â€œSkyWalking Java Agentâ€æ¥ä¸ŠæŠ¥ç›‘æ§æ•°æ®ã€‚</p><p>è¿™å°±éœ€è¦Javaå¾®æœåŠ¡åœ¨éƒ¨ç½²å¯åŠ¨çš„è¿‡ç¨‹ä¸­éœ€è¦è·å– <strong>SkyWalking Java Agent</strong> æ¢é’ˆåŒ…ï¼Œå¹¶åœ¨å¯åŠ¨å‚æ•°ä¸­é€šè¿‡<code>--javaagent:xxx</code>è¿›è¡Œå‚æ•°æŒ‡å®šã€‚è€Œå…·ä½“çš„é›†æˆæ–¹å¼å¤§è‡´æœ‰ä»¥ä¸‹å››ç§ï¼š</p><ul><li><p>ä½¿ç”¨å®˜æ–¹æä¾›çš„åŸºç¡€é•œåƒï¼›</p></li><li><p>å°†agentåŒ…æ„å»ºåˆ°å·²å­˜åœ¨çš„åŸºç¡€é•œåƒä¸­ï¼›</p></li><li><p>å°†agentåŒ…æ”¾åˆ°å…±äº«volumeä¸­;</p></li><li><p>é€šè¿‡sidecar æ¨¡å¼æŒ‚è½½agentï¼›</p></li></ul><p>å…¶ä¸­å‰ä¸¤ç§æ–¹å¼ä¸»è¦æ˜¯é€šè¿‡åœ¨æ„å»ºDockeré•œåƒçš„è¿‡ç¨‹ä¸­å°†Agentä¾èµ–æ‰“åŒ…é›†æˆåˆ°JavaæœåŠ¡çš„Dockeré•œåƒä¸­ï¼Œè€Œsidecaræ¨¡å¼åˆ™æ˜¯åˆ©ç”¨k8sçš„ç›¸å…³ç‰¹æ€§æ¥å®ç°åœ¨<strong>å®¹å™¨å¯åŠ¨æ—¶æŒ‚è½½Agent</strong>ç›¸å…³ä¾èµ–ã€‚</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="ä¸ºä»€ä¹ˆé€‰æ‹©sidecar">ä¸ºä»€ä¹ˆé€‰æ‹©sidecar<a class="hash-link" href="#ä¸ºä»€ä¹ˆé€‰æ‹©sidecar" title="Direct link to heading">â€‹</a></h3><p>Sidecardä¸»è¦åŸç†æ˜¯é€šè¿‡Kubernetesçš„åˆå§‹åŒ–å®¹å™¨<code>initContainers</code>æ¥å®ç°çš„ï¼Œ<code>initContainers</code>æ˜¯ä¸€ç§ä¸“ç”¨å®¹å™¨ï¼Œå®ƒåº”ç”¨å®¹å™¨å¯åŠ¨ä¹‹å‰è¿è¡Œï¼Œå¯ä»¥ç”¨äºå®Œæˆåº”ç”¨å¯åŠ¨å‰çš„å¿…è¦åˆå§‹åŒ–å·¥ä½œã€‚å¦‚æœå¾®æœåŠ¡æ˜¯ç›´æ¥éƒ¨ç½²åœ¨ Kubernetes é›†ç¾¤ï¼Œé‚£ä¹ˆé‡‡ç”¨ sidecar æ¨¡å¼æ¥ä½¿ç”¨ SkyWalking Agentä¼šæ›´åŠ æ–¹ä¾¿ï¼Œå› ä¸ºè¿™ç§æ–¹å¼<strong>ä¸éœ€è¦ä¿®æ”¹åŸæ¥çš„åŸºç¡€é•œåƒï¼Œä¹Ÿä¸éœ€è¦é‡æ–°æ„å»ºæ–°çš„æœåŠ¡é•œåƒ</strong>ï¼Œè€Œæ˜¯ä¼šä»¥sidecaræ¨¡å¼ï¼Œé€šè¿‡å…±äº«çš„volumeå°†agentæ‰€éœ€çš„ç›¸å…³æ–‡ä»¶ç›´æ¥æŒ‚è½½åˆ°å·²ç»å­˜åœ¨çš„æœåŠ¡é•œåƒä¸­ã€‚</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="åˆå§‹åŒ–å®¹å™¨initcontainers">åˆå§‹åŒ–å®¹å™¨InitContainers<a class="hash-link" href="#åˆå§‹åŒ–å®¹å™¨initcontainers" title="Direct link to heading">â€‹</a></h3><p>InitContainers å°±æ˜¯ç”¨æ¥åšåˆå§‹åŒ–å·¥ä½œçš„å®¹å™¨ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªæˆ–è€…å¤šä¸ªï¼Œå¦‚æœæœ‰å¤šä¸ªçš„è¯ï¼Œè¿™äº›å®¹å™¨ä¼šæŒ‰å®šä¹‰çš„é¡ºåºä¾æ¬¡æ‰§è¡Œï¼Œåªæœ‰æ‰€æœ‰çš„initContainersæ‰§è¡Œå®Œåï¼Œä¸»å®¹å™¨æ‰ä¼šè¢«å¯åŠ¨ã€‚æˆ‘ä»¬çŸ¥é“ä¸€ä¸ªPodé‡Œé¢çš„æ‰€æœ‰å®¹å™¨æ˜¯å…±äº«æ•°æ®å·å’Œç½‘ç»œå‘½åç©ºé—´çš„ï¼Œæ‰€ä»¥<code>initContainers</code>é‡Œé¢äº§ç”Ÿçš„æ•°æ®å¯ä»¥è¢«ä¸»å®¹å™¨ä½¿ç”¨åˆ°çš„</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="è‡ªå®šä¹‰skywalking-agenté•œåƒ"><strong>è‡ªå®šä¹‰SkyWalking Agenté•œåƒ</strong><a class="hash-link" href="#è‡ªå®šä¹‰skywalking-agenté•œåƒ" title="Direct link to heading">â€‹</a></h3><ul><li>ä¸‹è½½SkyWalkingå®˜æ–¹å‘è¡ŒåŒ…ï¼Œå¹¶è§£å‹åˆ°æŒ‡å®šç›®å½•</li></ul><div class="codeBlockContainer_I0IT language-Bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-Bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">#ä¸‹è½½skywalking-8.6.0 for es7ç‰ˆæœ¬çš„å‘å¸ƒåŒ…ï¼Œä¸éƒ¨ç½²çš„skywalkingåç«¯ç‰ˆæœ¬ä¸€è‡´</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ wget https://archive.apache.org/dist/skywalking/8.6.0/apache-skywalking-apm-8.6.0.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#å°†ä¸‹è½½çš„å‘å¸ƒåŒ…è§£å‹åˆ°å½“å‰ç›®å½•</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ tar -zxvf apache-skywalking-apm-es7-8.6.0.tar.gz</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><ul><li>ä¿®æ”¹é…ç½®ï¼Œç¼–è¾‘config/agent.configæ–‡ä»¶ï¼Œä»¥ä¸‹åªåˆ—å‡ºéƒ¨åˆ†é…ç½®é¡¹</li></ul><div class="codeBlockContainer_I0IT language-Bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-Bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain"># The agent namespace</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># agent.namespace=${SW_AGENT_NAMESPACE:default-namespace}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># è¡¨ç¤ºæä¾›ç›¸åŒåŠŸèƒ½/é€»è¾‘çš„é€»è¾‘ç»„çš„æœåŠ¡åç§°</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">agent.service_name=${SW_AGENT_NAME:Your_ApplicationName}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># OAPæœåŠ¡åœ°å€ï¼Œä¿®æ”¹é»˜è®¤åœ°å€ä¸ºskywalking-oapæœåŠ¡å</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">collector.backend_service=${SW_AGENT_COLLECTOR_BACKEND_SERVICES:skywalking-oap:11800}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># æ—¥å¿—æ–‡ä»¶å</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">logging.file_name=${SW_LOGGING_FILE_NAME:skywalking-api.log}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># æ—¥å¿—çº§åˆ«ï¼šTRACEã€DEBUGã€INFOã€WARNã€ERRORã€OFFã€‚</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">logging.level=${SW_LOGGING_LEVEL:INFO}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># æœ€å¤§å†å²æ—¥å¿—æ–‡ä»¶ã€‚å‘ç”Ÿç¿»è½¬æ—¶ï¼Œå¦‚æœæ—¥å¿—æ–‡ä»¶è¶…è¿‡æ­¤æ•°é‡ï¼Œåˆ™æœ€æ—§çš„æ–‡ä»¶å°†è¢«åˆ é™¤ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè´Ÿæ•°æˆ–é›¶è¡¨ç¤ºå…³é—­ã€‚</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">logging.max_history_files=${SW_LOGGING_MAX_HISTORY_FILES:10}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># æŒ‚è½½æ’ä»¶çš„ç‰¹å®šæ–‡ä»¶å¤¹ã€‚å®‰è£…æ–‡ä»¶å¤¹ä¸­çš„æ’ä»¶å¯ä»¥å·¥ä½œã€‚</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plugin.mount=${SW_MOUNT_FOLDERS:plugins,activations,bootstrap-plugins}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># æ’é™¤æ’ä»¶ç›®å½•ä¸­å®šä¹‰çš„ä¸€äº›æ’ä»¶</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># plugin.exclude_plugins=${SW_EXCLUDE_PLUGINS:}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><ul><li>æ„å»ºskywalking-agent sidecar é•œåƒå¹¶pushè‡³hubç§æœ‰é•œåƒä»“åº“</li></ul><p>åœ¨å‰é¢æ­¥éª¤ä¸­è§£å‹çš„skywalkingå‘è¡ŒåŒ…ï¼Œè¿›å…¥agentç›®å½•ç¼–å†™Dockerfileæ–‡ä»¶</p><div class="codeBlockContainer_I0IT language-Bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-Bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">FROM busybox:latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN set -eux &amp;&amp; mkdir -p /usr/skywalking/agent/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY . /usr/skywalking/agent/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WORKDIR /</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><ul><li>å®ŒæˆDockeræ–‡ä»¶ç¼–å†™åï¼Œæ‰§è¡Œé•œåƒæ„å»ºå‘½ä»¤ï¼š</li></ul><div class="codeBlockContainer_I0IT language-Bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-Bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain"># æ„å»ºé•œåƒï¼Œæ³¨æ„æœ€åä¸€ä¸ª.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker build -t &lt;your-registry&gt;/skywalking-agent-sidecar:8.6.0 .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># é•œåƒæ¨é€è‡³ç§æœ‰Harborä»“åº“</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker push &lt;your-registry&gt;/skywalking-agent-sidecar:8.6.0</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="sidecaræŒ‚è½½">sidecaræŒ‚è½½<a class="hash-link" href="#sidecaræŒ‚è½½" title="Direct link to heading">â€‹</a></h3><p>åœ¨KubeGemsä¸­æ‰¾åˆ° ã€å·¥ä½œè´Ÿè½½ã€‘ï¼Œç¼–è¾‘æ›´æ–°å·¥ä½œè´Ÿè½½è¿›å…¥åˆ°å®¹å™¨é•œåƒé¡µé¢</p><p><strong>è®¾ç½®SWç¯å¢ƒå˜é‡</strong>ï¼Œç¼–è¾‘å·¥ä½œå®¹å™¨ </p><ul><li>SW_AGENT_NAME=\&lt;YourApplicationName<!-- -->&gt;</li><li>JAVA_TOOL_OPTIONS=-javaagent:/usr/skywalking/agent/skywalking-agent.jar</li></ul><p><strong>æ·»åŠ å®¹å™¨é•œåƒ</strong>ï¼Œé€‰æ‹©åˆå§‹åŒ–å®¹å™¨å°†skywalking-agent-sidecardé•œåƒè¿›è¡ŒæŒ‚è½½ï¼Œå¹¶æ·»åŠ å¯åŠ¨å‘½ä»¤</p><div class="codeBlockContainer_I0IT language-Bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-Bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">sh -c /usr/skywalking/agent/* /skywalking/agent</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p><img loading="lazy" src="https://img-blog.csdnimg.cn/img_convert/cad0e71470d041f2ef2dbf86da258abc.png" alt="img" class="img_E7b_"></p><p><strong>æŒ‚è½½emptyDirå·</strong></p><p><img loading="lazy" src="https://img-blog.csdnimg.cn/img_convert/e34455919c3c6dbd6334609aad32bd26.png" alt="img" class="img_E7b_"></p><p>ç‚¹å‡»ç¡®å®šä¿å­˜å·¥ä½œè´Ÿè½½ä¿¡æ¯ï¼Œè‡ªåŠ¨é‡å¯åè¿›å…¥åº”ç”¨å®¹å™¨ï¼Œå¯ä»¥çœ‹åˆ°agentç›®æ ‡å·²ç»åŠ è½½åˆ°å®¹å™¨ä¸­äº†</p><div class="codeBlockContainer_I0IT language-Bash theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-Bash codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">root@pod-7bc77468ff-7b4xt:/# cd /usr/skywalking/agent/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@pod-7bc77468ff-7b4xt:/usr/skywalking/agent# ll</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">total 17716</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwxrwxrwx 9 root root      194 May 19 08:14 ./</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwxr-xr-x 3 root root       27 May 19 08:14 ../</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-r--r-- 1 root root      114 May 19 08:14 Dockerfile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwxr-xr-x 2 root root     4096 May 19 08:14 activations/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwxr-xr-x 2 root root       85 May 19 08:14 bootstrap-plugins/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwxr-xr-x 2 root root       64 May 19 08:14 config/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwxr-xr-x 2 root root       32 May 19 08:14 logs/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwxr-xr-x 2 root root     4096 May 19 08:14 optional-plugins/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwxr-xr-x 2 root root       45 May 19 08:14 optional-reporter-plugins/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drwxr-xr-x 2 root root     4096 May 19 08:14 plugins/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-r--r-- 1 root root 18121582 May 19 08:14 skywalking-agent.jar</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>æ­¤æ—¶æ‰“å¼€skywalking-uiï¼Œå·²ç»å¯ä»¥çœ‹åˆ°ç›‘æ§æ•°æ®äº†</p><p><img loading="lazy" src="https://img-blog.csdnimg.cn/img_convert/144d7ab53fc6553098b3e70193f2a74d.png" alt="img" class="img_E7b_"></p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="skywalkingåŠ¨æ€é…ç½®">SkyWalkingåŠ¨æ€é…ç½®<a class="hash-link" href="#skywalkingåŠ¨æ€é…ç½®" title="Direct link to heading">â€‹</a></h2><p>SkyWalkingé…ç½®ä¸»è¦æ˜¯é€šè¿‡<code>application.yml</code>æ“ä½œç³»ç»Ÿç¯å¢ƒå˜é‡è®¾ç½®çš„ï¼Œå…¶ä¸­ä¸€äº›è¿˜æ”¯æŒæ¥è‡ªä¸Šæ¸¸ç®¡ç†ç³»ç»Ÿçš„åŠ¨æ€è®¾ç½®ã€‚ä¸Šæ¸¸æœåŠ¡æ”¯æŒåŒ…æ‹¬Zookeeperã€Etcdã€Consulã€Apolloã€Nacosã€K8s-configmapç­‰ã€‚</p><p>ç›®å‰SkyWalkingæ”¯æŒä»¥ä¸‹åŠ¨æ€é…ç½®</p><table><thead><tr><th align="center">é…ç½®</th><th align="left">è¯´æ˜</th></tr></thead><tbody><tr><td align="center">agent-analyzer.default.slowDBAccessThreshold</td><td align="left"><code>receiver-trace/default/slowDBAccessThreshold</code>æ…¢æ•°æ®åº“è¯­å¥çš„é˜ˆå€¼ï¼Œè¦†ç›–<code>application.yml</code>.</td></tr><tr><td align="center">agent-analyzer.default.uninstrumentedGateways</td><td align="left">æœªæ£€æµ‹çš„ç½‘å…³è¦†ç›–<code>gateways.yml</code>.</td></tr><tr><td align="center">alarm.default.alarm-settings</td><td align="left">è­¦æŠ¥è®¾ç½®å°†è¦†ç›–<code>alarm-settings.yml</code>ã€‚</td></tr><tr><td align="center">core.default.apdexThreshold</td><td align="left">apdex é˜ˆå€¼è®¾ç½®ï¼Œå°†è¦†ç›–<code>service-apdex-threshold.yml</code>.</td></tr><tr><td align="center">core.default.endpoint-name-grouping</td><td align="left">ç«¯ç‚¹åç§°åˆ†ç»„è®¾ç½®ï¼Œå°†è¦†ç›–<code>endpoint-name-grouping.yml</code>.</td></tr><tr><td align="center">agent-analyzer.default.sampleRate</td><td align="left">è·Ÿè¸ªé‡‡æ ·ï¼Œè¦†ç›–<code>receiver-trace/default/sampleRate</code>.<code>application.yml</code></td></tr><tr><td align="center">agent-analyzer.default.slowTraceSegmentThreshold</td><td align="left">è®¾ç½®è¿™ä¸ªå…³äºå»¶è¿Ÿçš„é˜ˆå€¼å°†ä½¿æ…¢è·Ÿè¸ªæ®µåœ¨èŠ±è´¹æ›´å¤šæ—¶é—´æ—¶è¢«é‡‡æ ·ï¼Œå³ä½¿é‡‡æ ·æœºåˆ¶è¢«æ¿€æ´»ã€‚é»˜è®¤å€¼ä¸º<code>-1</code>ï¼Œè¿™æ„å‘³ç€ä¸ä¼šå¯¹æ…¢é€Ÿè·Ÿè¸ªè¿›è¡Œé‡‡æ ·ã€‚å•ä½ï¼Œæ¯«ç§’ã€‚çš„è¦†ç›–<code>receiver-trace/default/slowTraceSegmentThreshold</code>ã€‚<code>application.yml</code></td></tr><tr><td align="center">configuration-discovery.default.agentConfigurations</td><td align="left">ConfigurationDiscovery è®¾ç½®</td></tr></tbody></table><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="k8s-configmap">k8s-configmap<a class="hash-link" href="#k8s-configmap" title="Direct link to heading">â€‹</a></h3><blockquote><p>å¾ˆå¤šåº”ç”¨åœ¨å…¶åˆå§‹åŒ–æˆ–è¿è¡ŒæœŸé—´è¦ä¾èµ–ä¸€äº›é…ç½®ä¿¡æ¯ã€‚å¤§å¤šæ•°æ—¶å€™ï¼Œ å­˜åœ¨è¦è°ƒæ•´é…ç½®å‚æ•°æ‰€è®¾ç½®çš„æ•°å€¼çš„éœ€æ±‚ã€‚ ConfigMap æ˜¯ Kubernetes ç”¨æ¥å‘åº”ç”¨ Pod ä¸­æ³¨å…¥é…ç½®æ•°æ®çš„æ–¹æ³•ã€‚</p></blockquote><p>æœ¬æ–‡ä»‹ç»å¦‚ä½•é€šè¿‡KubGemså¹³å°åŠ¨æ€é…ç½®SkyWalkingå‚æ•°</p><ul><li>KubGemså·¥ä½œå° --&gt; é…ç½®ä¸­å¿ƒ --&gt; é…ç½® --&gt; åˆ›å»ºé…ç½®</li><li>æ·»åŠ å‚æ•°åŠå‘Šè­¦è§„åˆ™é…ç½®</li></ul><p><img loading="lazy" src="https://img-blog.csdnimg.cn/img_convert/ae9fc31a7b36272e16f1ecaa7a686a4b.png" alt="img" class="img_E7b_"></p><ul><li>ç¼–è¾‘yamlï¼Œæ·»åŠ ä¿®æ”¹appã€compoentæ ‡ç­¾å€¼</li></ul><div class="codeBlockContainer_I0IT language-YAML theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-YAML codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">kind: ConfigMap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: skywalking-dynamic-config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  namespace: default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  creationTimestamp: &#x27;2022-05-16T11:14:23Z&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    component: oap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  agent-analyzer.default.sampleRate: &#x27;7000&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  agent-analyzer.default.slowDBAccessThreshold: default:250,mongodb:100</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  alarm.default.alarm-settings: &gt;-</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rules:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      # Rule unique name, must be ended with `_rule`.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      service_resp_time_rule:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        metrics-name: service_resp_time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        op: &quot;&gt;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        threshold: 2000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        period: 10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        count: 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        silence-period: 5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        message: æœ€è¿‘3åˆ†é’Ÿå†…æœåŠ¡ {name} çš„å¹³å‡å“åº”æ—¶é—´è¶…è¿‡2ç§’</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><ul><li>ä¿®æ”¹skywalking-oapç¯å¢ƒå˜é‡ä¿¡æ¯ï¼Œä½¿ç”¨k8s-configmapé…ç½®</li></ul><div class="codeBlockContainer_I0IT language-YAML theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-YAML codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: apps/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: Deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: skywalking-oap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    app: skywalking</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    app.kubernetes.io/instance: skywalking</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.........</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  env:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .....</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - name: SW_CLUSTER_K8S_LABEL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      value: app=skywalking,component=oap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - name: SW_CONFIGURATION</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      value: k8s-configmap</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><blockquote><p><code>SW_CONFIGURATION= k8s-configmap</code>ï¼ŒåŠ¨æ€é…ç½®é‡‡ç”¨k8s-configmap
<code>SW_CLUSTER_K8S_LABEL= app=collector,release=skywalking</code>ï¼Œæ ¹æ®è¿™ä¸ªå€¼è‡ªåŠ¨é€‰æ‹©åˆé€‚çš„configmap</p></blockquote><ul><li>é‡å¯skywalking-oapï¼Œé…ç½®ç”Ÿæ•ˆ</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="skywalkingé…ç½®ä¼˜åŒ–">SkyWalkingé…ç½®ä¼˜åŒ–<a class="hash-link" href="#skywalkingé…ç½®ä¼˜åŒ–" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="oapä¼˜åŒ–">OAPä¼˜åŒ–<a class="hash-link" href="#oapä¼˜åŒ–" title="Direct link to heading">â€‹</a></h3><p> skywalkingå†™å…¥ESçš„æ“ä½œæ˜¯ä½¿ç”¨äº†ESçš„æ‰¹é‡å†™å…¥æ¥å£ï¼Œæˆ‘ä»¬è¦åšçš„æ˜¯è°ƒæ•´ç›¸å…³å‚æ•°å°½é‡é™ä½ESç´¢å¼•çš„å†™å…¥é¢‘ç‡ã€‚ å‚æ•°è°ƒæ•´ä¸»è¦æ˜¯é’ˆå¯¹skywalkingçš„é…ç½®æ–‡ä»¶`<code>application.yml</code>ï¼Œç›¸å…³å‚æ•°å¦‚ä¸‹ï¼š  </p><div class="codeBlockContainer_I0IT language-YAML theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-YAML codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">storage:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  elasticsearch:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bulkActions: ${SW_STORAGE_ES_BULK_ACTIONS:4000} # Execute the bulk every 2000 requests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bulkSize: ${SW_STORAGE_ES_BULK_SIZE:40} # flush the bulk every 20mb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    flushInterval: ${SW_STORAGE_ES_FLUSH_INTERVAL:30} # flush the bulk every 10 seconds whatever the number of requests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    concurrentRequests: ${SW_STORAGE_ES_CONCURRENT_REQUESTS:4} # the number of concurrent requests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metadataQueryMaxSize: ${SW_STORAGE_ES_QUERY_MAX_SIZE:8000}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>è°ƒæ•´ bulkActions é»˜è®¤2000æ¬¡è¯·æ±‚æ‰¹é‡å†™å…¥ä¸€æ¬¡æ”¹åˆ°4000æ¬¡ï¼›</p><ul><li><p>bulkSizeæ‰¹é‡åˆ·æ–°ä»20Mä¸€æ¬¡åˆ°40Mä¸€æ¬¡ï¼›</p></li><li><p>flushIntervalæ¯10ç§’åˆ·æ–°ä¸€æ¬¡å †æ”¹ä¸ºæ¯30ç§’åˆ·æ–°ï¼›</p></li><li><p>concurrentRequestsæŸ¥è¯¢çš„æœ€å¤§æ•°é‡ç”±5000æ”¹ä¸º8000ã€‚</p></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="è¿‡æ»¤ä¸éœ€è¦ç›‘æ§çš„æ¥å£">è¿‡æ»¤ä¸éœ€è¦ç›‘æ§çš„æ¥å£<a class="hash-link" href="#è¿‡æ»¤ä¸éœ€è¦ç›‘æ§çš„æ¥å£" title="Direct link to heading">â€‹</a></h3><ul><li><p>åˆ¶ä½œagenté•œåƒæ—¶ï¼Œå°†<code>apm-trace-ignore-plugin-8.6.0.jar</code>å¤åˆ¶åˆ°<code>\plugins</code>ä¸‹é¢</p></li><li><p>configç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶ <code>apm-trace-ignore-plugin.config</code>ï¼Œæ–‡ä»¶å†…å®¹ä¸ºï¼š </p></li></ul><div class="codeBlockContainer_I0IT language-YAML theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-YAML codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">trace.ignore_path=${SW_AGENT_TRACE_IGNORE_PATH:/actuator,/actuator/**,/admin/**,/nacos/**}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="è®¾ç½®é‡‡æ ·ç‡">è®¾ç½®é‡‡æ ·ç‡<a class="hash-link" href="#è®¾ç½®é‡‡æ ·ç‡" title="Direct link to heading">â€‹</a></h3><p> åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒSkyWalkingä¼šé‡‡é›†æ‰€æœ‰è¿½è¸ªçš„æ•°æ®ã€‚ä½†æ˜¯å¦‚æœç³»ç»Ÿæ¯”è¾ƒå¤æ‚ï¼Œé‡‡é›†çš„ç«¯ç‚¹æ¯”è¾ƒå¤šçš„æ—¶å€™ï¼Œå¯èƒ½å­˜å‚¨å‹åŠ›æ¯”è¾ƒå¤§ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥ä¿®æ”¹é…ç½®ï¼Œåªå­˜å‚¨éƒ¨åˆ†çš„è°ƒç”¨é“¾è·¯ä¿¡æ¯ã€‚æ¯”å¦‚ï¼š50%ã€‚ è®¾ç½®é‡‡æ ·ç‡çš„æ—¶å€™å¹¶ä¸ä¼šå½±å“ç›¸å…³æŒ‡æ ‡çš„è®¡ç®—ã€‚åŒ…æ‹¬æœåŠ¡ï¼ŒæœåŠ¡å®ä¾‹ï¼Œç«¯ç‚¹ï¼Œæ‹“æ‰‘å›¾ç­‰ç›¸å…³æŒ‡æ ‡çš„è®¡ç®—è¿˜æ˜¯ä½¿ç”¨å®Œæ•´çš„æ•°æ®è®¡ç®—çš„ã€‚ </p><p>åœ¨k8s-configmapä¸­ï¼Œæ·»åŠ é…ç½®é¡¹ï¼Œè®¾ç½®é‡‡æ ·ç‡ä¸º70%:</p><div class="codeBlockContainer_I0IT language-YAML theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-YAML codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">agent-analyzer.default.sampleRate: &#x27;7000&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="æ€»ç»“">æ€»ç»“<a class="hash-link" href="#æ€»ç»“" title="Direct link to heading">â€‹</a></h2><p>æœ¬æ–‡ç”¨äºæŒ‡å¯¼ç”¨äºåœ¨ KubeGems ä¸­å¿«é€Ÿéƒ¨ç½²å¹¶è¿è¡Œ SkyWalkingæœåŠ¡ï¼Œç”¨æˆ·å¯åœ¨ç ”å‘ç¯å¢ƒä¸­å¿«é€Ÿå¯ç”¨æ­¤åŠŸèƒ½æ¥éªŒè¯ APM ç›¸å…³åŠŸèƒ½ã€‚æ›´å¤šå…³äºKubeGems ä¸ SkyWalking çš„é…ç½®ä¼˜åŒ–ï¼Œæˆ‘ä»¬ä¼šæŒç»­æ›´æ–°ï¼Œæ•¬è¯·å…³æ³¨ã€‚</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/blog/tags/kubernetes">kubernetes</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/blog/tags/tracing">tracing</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/blog/tags/observability">observability</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/blog/tags/kubegems">kubegems</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about åŸºäºKubeGemså¯è§†åŒ–æ­å»ºSkyWalking" href="/blog/kubegems-skywalking"><b>Read More</b></a></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="blogPostTitle_rzP5" itemprop="headline"><a itemprop="url" href="/blog/kubegems-logging">KubeGems ä¸­çš„æ—¥å¿—è®¾è®¡</a></h2><div class="blogPostData_Zg1s margin-vert--md"><time datetime="2022-04-11T00:00:00.000Z" itemprop="datePublished">2022å¹´4æœˆ11æ—¥</time> Â· <!-- -->One min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_FlmR"><div class="avatar margin-bottom--sm"><span class="avatar__photo-link avatar__photo"><a href="https://github.com/LinkMaq" target="_blank" rel="noopener noreferrer"><img class="image_o0gy" src="https://github.com/LinkMaq.png" alt="LinkMaq"></a></span><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/LinkMaq" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">LinkMaq</span></a></div><small class="avatar__subtitle" itemprop="description">developer@kubegems.io</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p><img loading="lazy" src="https://github.com/kubegems/.github/blob/master/static/image/kubegem-logo.jpg?raw=true" class="img_E7b_"></p><p><code>KubeGems Logging</code> æœåŠ¡ä¸»è¦é¢å‘å¹³å°å†…éƒ¨ä»¥åŠå¹³å°å†…ç§Ÿæˆ·æä¾›æ—¥å¿—é‡‡é›†ã€è§£æã€ä¼ è¾“å’Œå­˜å‚¨ç­‰ç›¸å…³çš„èƒ½åŠ›ã€‚ä¾é  Logging Operator å¯¹æ—¥å¿—çš„é…ç½®å’Œè·¯ç”±ç®¡ç†ï¼Œå®ç°å¹³å°çš„ç»ˆç«¯ç”¨æˆ·å¯ä»¥å¯¹åº”ç”¨è¿è¡ŒæœŸé—´çš„æ—¥å¿—è¿›è¡Œå®æ—¶æŸ¥è¯¢å’Œåˆ†æã€‚KubeGems æ—¥å¿—æŒä¹…åŒ–é‡‡ç”¨ Grafana Loki å®ç°ã€‚</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="æ ¸å¿ƒéœ€æ±‚">æ ¸å¿ƒéœ€æ±‚<a class="hash-link" href="#æ ¸å¿ƒéœ€æ±‚" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="å¤šç§Ÿæˆ·">å¤šç§Ÿæˆ·<a class="hash-link" href="#å¤šç§Ÿæˆ·" title="Direct link to heading">â€‹</a></h3><p>KubeGems æ˜¯ä¸€ä¸ªå¤šç§Ÿæˆ·å¹³å°ï¼ŒåŸºäºæ­¤åœºæ™¯ã€‚å¹³å°å†…éƒ¨å¯¹äºç§Ÿæˆ·åº”ç”¨äº§ç”Ÿçš„æ—¥å¿—åº”è¯¥å…·å¤‡<strong>ç‹¬ç«‹çš„è§£æé…ç½®ä»¥åŠè·¯ç”±è§„åˆ™</strong>ã€‚</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="ç³»ç»Ÿé²æ£’æ€§">ç³»ç»Ÿé²æ£’æ€§<a class="hash-link" href="#ç³»ç»Ÿé²æ£’æ€§" title="Direct link to heading">â€‹</a></h3><ul><li><p>é«˜æ€§èƒ½</p><ul><li>æ—¥å¿—é‡‡é›†å’Œè½¬å‘æ€§èƒ½è‡³å°‘éœ€å¤„ç† 10K line/sec</li><li>æ”¯æŒé‡‡å–æ—¥å¿—é™æµç­–ç•¥</li><li>æ—¥å¿—å»¶è¿Ÿä¸å¾—ä½äº 5min</li></ul></li><li><p>å¯æ‰©å±•</p><ul><li>æ¶æ„æ”¯æŒçµæ´»çš„æ°´å¹³æ‰©å±•ä»¥æå‡æ•´ä½“æ—¥å¿—ååé‡</li><li>ç»„ä»¶å› æ»¡è¶³æ— çŠ¶æ€å±æ€§</li></ul></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="å¯è¿ç»´æ€§">å¯è¿ç»´æ€§<a class="hash-link" href="#å¯è¿ç»´æ€§" title="Direct link to heading">â€‹</a></h3><ul><li><p>å¯é…ç½®</p><ul><li>æ—¥å¿—è§„åˆ™å’Œè·¯ç”±çš„é…ç½®åº” CRD åŒ–ï¼Œç”± Operator ç»Ÿä¸€ç®¡ç†ï¼Œå¹¶å°½é‡åšåˆ°é…ç½®ç®€åŒ–ã€‚</li><li>éœ€æ”¯æŒå¸¸è§çš„ <code>json è§£æ</code>ã€<code>å­—æ®µå¢åˆ æ”¹</code> ç­‰æ’ä»¶é…ç½®ã€‚</li><li>åº”ç”¨æ—¥å¿—åº”æ»¡è¶³å‘é€å¤šç§å¸¸è§çš„æ•°æ®ç®¡é“æˆ–æ”¶é›†ç³»ç»Ÿï¼Œè¯¸å¦‚ kafkaã€elasticSearchã€MongoDB ç­‰ã€‚</li></ul></li><li><p>å¯è§†åŒ–</p><ul><li>æ—¥å¿—è§„åˆ™åº”åœ¨ UI ä¸­ç”±ç”¨æˆ·ç»„åˆè£…é…ç½®æ—¥å¿—çš„è§£æä¸è¾“å‡ºè§„åˆ™ã€‚</li></ul></li><li><p>ç›‘æ§ä¸å‘Šè­¦</p><ul><li>æ—¥å¿—é‡‡é›†çš„çŠ¶æ€ç»Ÿè®¡ï¼ŒåŒ…å«ç»„ä»¶è¿è¡ŒçŠ¶æ€ä»¥åŠæ—¥å¿—é‡‡é›†ç»Ÿè®¡ã€‚</li><li>éœ€æ”¯æŒç”¨æˆ·æ ¹æ®è‡ªå®šä¹‰æ—¥å¿—ç‰‡æ®µè¿›è¡Œè®¾ç½®å‘Šè­¦è§„åˆ™ã€‚</li></ul></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="éœ€æ±‚è¾¹ç•Œ">éœ€æ±‚è¾¹ç•Œ<a class="hash-link" href="#éœ€æ±‚è¾¹ç•Œ" title="Direct link to heading">â€‹</a></h3><ul><li>å¯¹äºåº”ç”¨æ—¥å¿—æ²¡æœ‰è¾“å‡ºåˆ°æ§åˆ¶å°ï¼ˆstdoutï¼‰çš„åœºæ™¯ï¼Œæš‚ä¸çº³å…¥é‡‡é›†éœ€æ±‚</li></ul><blockquote><p>å¯é‡‡å–å…¶ä»–æ–¹å¼é‡å®šå‘å†…éƒ¨æ—¥å¿—åˆ°æ§åˆ¶å°ï¼Œè¯¸å¦‚<code>s6-log</code></p></blockquote><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="æ—¥å¿—è®¾è®¡">æ—¥å¿—è®¾è®¡<a class="hash-link" href="#æ—¥å¿—è®¾è®¡" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="logging-operator">Logging Operator<a class="hash-link" href="#logging-operator" title="Direct link to heading">â€‹</a></h3><p>Logging Operator æ˜¯ BanzaiCloud ä¸‹å¼€æºçš„ä¸€ä¸ªäº‘åŸç”Ÿåœºæ™¯ä¸‹çš„æ—¥å¿—é‡‡é›†æ–¹æ¡ˆã€‚å®ƒåœ¨ 2020 å¹´ 3 æœˆçš„æ—¶å€™ç»è¿‡é‡æ„åçš„ v3 ç‰ˆæœ¬ï¼Œåº•å±‚å‡­å€Ÿé«˜æ•ˆçš„ fluentbit å’Œæ’ä»¶ä¸°å¯Œçš„ flunetdï¼ŒLogging Operatorå‡ ä¹å·²ç»å®Œç¾çš„é€‚é…äº† kubernetes æ¨¡å¼ä¸‹çš„æ—¥å¿—é‡‡é›†åœºæ™¯ã€‚</p><p>åœ¨ KubeGems 1.20 çš„ç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬é€‰æ‹©é‡‡ç”¨ Logging Operator ä½œä¸ºå†…éƒ¨æ—¥å¿—æµä¼ çš„æ ¸å¿ƒæ¡†æ¶ã€‚å…¶ä¸»è¦åŸå› å¦‚ä¸‹ï¼š</p><ul><li><p>åŸç”Ÿ Flow å’Œ Output ç±»èµ„æºä½œç”¨åŸŸä¸º kubernetes å‘½åç©ºé—´ï¼Œè¿™ä¸ KubeGems ç§Ÿæˆ·ç¯å¢ƒçš„èµ„æºç‹¬ç«‹æ€§ç›¸è°‹å’Œ</p></li><li><p>é‡‡ç”¨é«˜æ€§èƒ½çš„ fluentbit ä½œä¸ºæ—¥å¿—é‡‡é›†å®¢æˆ·ç«¯ï¼Œfluentd ä¸ºæ—¥å¿—èšåˆç«¯ã€‚flunetd åœ¨ logging ä¸­é€šè¿‡ <code>replicas</code> æ§åˆ¶å‰¯æœ¬æ•°ï¼Œå¯æ ¹æ®ååé‡æ°´å¹³æ‰©å®¹</p></li><li><p>flunetd æ”¯æŒçš„æ’ä»¶è¾ƒä¸ºä¸°å¯Œï¼Œæ»¡è¶³å½“å‰åŸºæœ¬éœ€æ±‚</p></li></ul><p>Logging Operator ä¸è¶³ï¼š</p><ul><li>æ ¸å¿ƒèµ„æº Flow å’Œ Output äº¤äºç”¨æˆ·é…ç½®è¾ƒä¸ºå›°éš¾ï¼Œéœ€è¦ KubeGems å°†èµ„æºå°è£…ï¼ˆä¹Ÿè®¸å…¼å®¹æºå¯¹è±¡ï¼‰</li><li>å¯è§‚æµ‹æ€§åŠŸèƒ½è¾ƒå¼±</li><li>æ—¥å¿— Match éƒ¨åˆ†åŠŸèƒ½è¾ƒå¼±ï¼Œæ— æ³•é€šè¿‡ç›´æ¥åŒ¹é… workload è¿›è¡Œå…³è”</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="kubegems-æ—¥å¿—æ•´ä½“æ¶æ„">KubeGems æ—¥å¿—æ•´ä½“æ¶æ„<a class="hash-link" href="#kubegems-æ—¥å¿—æ•´ä½“æ¶æ„" title="Direct link to heading">â€‹</a></h3><p><img loading="lazy" src="https://www.kubegems.io/assets/images/observability-logging-0d094d03e1d3d7e07e612975234fe44f.jpg" class="img_E7b_"></p><p>ç”± Logging Operator è´Ÿè´£æ—¥å¿—ç»„ä»¶çš„è¿è¡Œç®¡ç†å’Œé…ç½®ç®¡ç†ï¼Œç§Ÿæˆ·ä¾§èµ„æºä»¥ CR çš„æ–¹å¼åœ¨æ‰€å±çš„ç¯å¢ƒç©ºé—´ä¸­ç®¡ç†ã€‚Operator å°† CR æ¸²æŸ“ä¸º Fluentd çš„é…ç½®æ–‡ä»¶ï¼Œç”¨äºå¤„ç†æ—¥å¿—çš„è¿‡æ»¤å’Œè½¬å‘è§„åˆ™ã€‚å¯è§‚æµ‹éƒ¨åˆ†ï¼Œç”± KubeGems Plugins æœåŠ¡åˆå§‹åŒ– ServiceMonitorï¼ŒæŠ“å–ç»„ä»¶è¿è¡ŒæœŸé—´çš„çŠ¶æ€ã€‚</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="kubegems-logging">KubeGems Logging<a class="hash-link" href="#kubegems-logging" title="Direct link to heading">â€‹</a></h2><p>KubeGems å¯¹ Logging Operator çš„å°è£…ä»…æ»¡è¶³ç®€å•çš„ä¸¤ç§æ¨¡å¼çš„åœºæ™¯ï¼š</p><ul><li><p>ç²¾ç®€æ¨¡å¼</p><p> å¼€ç®±å³ç”¨çš„æ—¥å¿—é‡‡é›†æ¨¡å¼ï¼Œå¯¹äºç”¨æˆ·ç¯å¢ƒç©ºé—´å†…çš„æ‰€æœ‰å®¹å™¨å¼€å¯é‡‡é›†ï¼Œå¹¶è¾“å‡ºåˆ° KubeGems å¹³å°å†…ç½®çš„ Loki ç»„ä»¶ç”¨äºæ—¥å¿—åˆ†æå’Œå‘Šè­¦ç­‰åœºæ™¯</p></li><li><p>å±€éƒ¨è‡ªå®šä¹‰æ¨¡å¼</p><p>  é¢å‘å¸Œæœ›é€šè¿‡é…ç½®å±€éƒ¨å®¹å™¨é‡‡é›†ï¼Œå¹¶éœ€è¦å¯¹æ¥å¤–éƒ¨æ—¥å¿—åˆ†æç³»ç»Ÿçš„åœºæ™¯ã€‚åˆ™é‡‡ç”¨æ­¤æ–¹å¼ï¼Œä¸è¿‡æ­¤æ—¶</p></li></ul><p><img loading="lazy" src="/assets/images/logging-flow-cae426711b9ce472ccdafde0a59bc330.jpg" width="488" height="494" class="img_E7b_"></p><p>é™¤æ­¤ä¹‹å¤–ï¼Œå¯¹äºå¸Œæœ›èƒ½å¤Ÿå®Œå…¨æŒæ¡å¹³å°å†…çš„æ—¥å¿—è·¯ç”±çš„é«˜ç«¯ç”¨æˆ·ï¼ŒKubeGems åªéœ€å…¼å®¹å¯¹ Logging Operator çš„åŸå§‹ CR èµ„æºå³å¯ã€‚</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="ç²¾ç®€æ¨¡å¼">ç²¾ç®€æ¨¡å¼<a class="hash-link" href="#ç²¾ç®€æ¨¡å¼" title="Direct link to heading">â€‹</a></h3><p>å¯¹äºé€šç”¨åœºæ™¯ä¸‹çš„å®¹å™¨æ§åˆ¶å°æ—¥å¿—é‡‡é›†ï¼ŒKubeGems é‡‡ç”¨<code>ç²¾ç®€æ¨¡å¼</code>é…ç½®è§„åˆ™ï¼Œä»…éœ€åœ¨ç”¨æˆ·ç•Œé¢ä¸­æ”¯æŒ <strong>ä¸€é”®é…ç½®å¼€å¯æ—¥å¿—é‡‡é›†</strong> åŠŸèƒ½ã€‚<strong>ä¸€é”®å¯ç”¨åŠŸèƒ½</strong>çš„å®ç°ä¸»è¦åˆ†ä¸ºä¸¤éƒ¨åˆ†ã€‚</p><p><img loading="lazy" src="/assets/images/default-logging-flow-5dfa7b7a3cee69a1de49934bc737fabe.jpg" width="699" height="311" class="img_E7b_"></p><ol><li><p>KubeGems Installer æœåŠ¡åœ¨å¯¹ kubernetes é›†ç¾¤å¯ç”¨ logging æ’ä»¶æ—¶ï¼Œå°†å¯¹ <code>logging operator </code>ä»¥åŠå…³è”çš„ <code>clusteroutputs/containers-console</code>èµ„æºè¿›è¡Œåˆå§‹åŒ–ã€‚</p><blockquote><p>é»˜è®¤çš„clusteroutput èµ„æºå®šä¹‰äº†å®¹å™¨æ—¥å¿—çš„è¾“å‡ºè·¯å¾„æ˜¯ Loki</p></blockquote></li><li><p>ç”¨æˆ·åˆ›å»ºé»˜è®¤çš„å®¹å™¨é‡‡é›†è§„åˆ™æ—¶ï¼Œ<code>LabelSelector</code> ä¸ºç©ºï¼Œå³åŒ¹é…å½“å‰å‘½åç©ºé—´ä¸‹çš„æ‰€æœ‰ Podã€‚</p></li><li><p>Flow ä¸­åªå¯ç”¨ Prometheus æ’ä»¶ç”¨äºç»Ÿè®¡é‡‡é›†çŠ¶æ€ã€‚</p></li><li><p>Flow ä¸­å…³è”ç³»ç»Ÿé»˜è®¤çš„ <code>clusteroutputs/containers-console</code></p></li></ol><p>å³åœ¨<code>ç²¾ç®€æ¨¡å¼</code>ä¸‹ï¼ŒKubeGems åªåœ¨ç§Ÿæˆ·ç©ºé—´çš„æ¥å£ä¸­ä¼ å…¥å¦‚ä¸‹å‚æ•°ï¼š</p><div class="codeBlockContainer_I0IT language-apl theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-apl codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">POST  observe/log/&lt;tenant_name&gt;/flowlite?enabled=true&amp;namespace=tenant</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><table><thead><tr><th align="center">å‚æ•°</th><th align="center">é‡Šæ„</th><th align="center">required</th><th align="center">Type</th></tr></thead><tbody><tr><td align="center">enabled</td><td align="center">å¯ç”¨ç¯å¢ƒç©ºé—´çš„æ—¥å¿—é‡‡é›†åŠŸèƒ½</td><td align="center">True</td><td align="center">Boolean</td></tr><tr><td align="center">namespace</td><td align="center">é‡‡é›†æ—¥å¿—çš„ç›®æ ‡å‘½åç©ºé—´</td><td align="center">True</td><td align="center">String</td></tr></tbody></table><p>KubeGems å°† Flows æ¸²æŸ“ä¸ºå¦‚ä¸‹å†…å®¹ï¼š</p><div class="codeBlockContainer_I0IT language-yaml theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-yaml codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> logging.banzaicloud.io/v1beta1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Flow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> tenant</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">match</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">select</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">filters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">prometheus</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">container</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $.kubernetes.container_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $.kubernetes.namespace_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">node</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $.kubernetes.host</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">pod</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $.kubernetes.pod_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">metrics</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">desc</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Total number of log entries generated by either application containers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          or system components</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> logging_entry_count</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> counter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">globalOutputRefs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> containers</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">console</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="å±€éƒ¨è‡ªå®šä¹‰æ¨¡å¼">å±€éƒ¨è‡ªå®šä¹‰æ¨¡å¼<a class="hash-link" href="#å±€éƒ¨è‡ªå®šä¹‰æ¨¡å¼" title="Direct link to heading">â€‹</a></h3><p>ç”¨æˆ·å¦‚æœéœ€è¦æŒ‰ç…§åº”ç”¨æ—¥å¿—éœ€æ±‚ï¼Œå±€éƒ¨å¯¹ç¯å¢ƒç©ºå†…åº”ç”¨è¿›è¡Œæ—¥å¿—çš„è§„åˆ™å’Œè·¯ç”±æ—¶ï¼ŒKubeGems éœ€è¦å¯¹ Logging Operator çš„ CR èµ„æºè¿›è¡Œä¼˜åŒ–ï¼Œä»¥æ–¹é¢åœ¨ç”¨æˆ·ç•Œé¢ä¸­å®ç°è·Ÿå‹å¥½çš„äº¤äº’ã€‚å…¶ä¸­é¦–å…ˆéœ€è¦å¤„ç†å¹³å° <strong>åº”ç”¨å…ƒæ•°æ®</strong> ç›¸å…³çš„äº‹åŠ¡ã€‚é»˜è®¤æƒ…å†µä¸‹ Flow çš„è§„åˆ™é‡‡ç”¨ <code>labelSelector </code>å¯¹å‘½åç©ºé—´å†…èµ„æºåšåŒ¹é…ï¼Œå¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_I0IT language-yaml theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-yaml codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> logging.banzaicloud.io/v1beta1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Flow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> default </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> tenant</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">localOutputRefs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> defalt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">match</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">select</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>è™½ç„¶é€šè¿‡ <code>labelSelector</code>å¯ä»¥çµæ´»æ§åˆ¶æ—¥å¿—é‡‡é›†è§„åˆ™ï¼Œä½†ç»è¿‡å®é™…éªŒè¯ï¼Œè¿™ä¸ªé€»è¾‘ä»ç„¶å­˜åœ¨ <strong>åç›´è§‰çš„åœºæ™¯</strong>ï¼Œç”¨æˆ·å¤§å¤šéœ€è¦çš„æ˜¯<strong>åœ¨ Selector é˜¶æ®µä¸åº”ç”¨èµ„æºç›´æ¥å…³è”</strong> ï¼Œå½“ç„¶æˆ‘ä»¬ä¸èƒ½ç›´æ¥æŠŠ<code>label ä¸ workload åšç­‰åŒæ˜ å°„</code>ã€‚æˆ‘ä»¬éœ€è¦é€šè¿‡å¤–éƒ¨æ–¹å¼æ¥å¯¹ Label åšé€šç”¨æ€§åŒ¹é…ã€‚</p><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="kubegems-commonlabels">KubeGems CommonLabels<a class="hash-link" href="#kubegems-commonlabels" title="Direct link to heading">â€‹</a></h4><p><strong>KubeGems é€šç”¨æ ‡ç­¾</strong> æ˜¯æ ¹æ®ç”¨æˆ·ä¸Šå±‚æ“ä½œè€Œå¯¹ Kubernetes Workload åšè‡ªåŠ¨æ³¨å…¥çš„ä¸€ç»„å…ƒæ•°æ®ã€‚å®ƒæ˜¯ä¸€ç»„å¸¸é‡ï¼Œè¢«å®šä¹‰åˆ°<code>common.go</code>å½“ä¸­ã€‚ å½“ç”¨æˆ·åœ¨ Kubernetes ä¸­åšèµ„æºå¯¹è±¡çš„æ“ä½œæ—¶ï¼Œå®ƒä¼šä»¥ <code>mutatingwebhook</code>çš„æ–¹å¼è‡ªåŠ¨æ³¨å…¥çš„è¢«ç®¡ç†çš„èµ„æºå¯¹è±¡å½“ä¸­ã€‚</p><p><img loading="lazy" src="/assets/images/commonLabel-timing-fc293782ffb92cb624b38bccd5f62820.jpg" width="706" height="284" class="img_E7b_"></p><p>CommonLabel ä¸­çš„ <code>kubegems.io/applications</code> æˆ–è€… Kubernetes ä¸­çš„ <code>app.kubernetes.io/name</code>æˆ–<code>app</code>å…±åŒå£°æ˜äº†è¯¥åº”ç”¨çš„ workerload æ ‡ç­¾ã€‚åŸºäºæ­¤ï¼Œç”¨æˆ·åœ¨åˆ›å»ºæ—¥å¿—è§„åˆ™æ˜¯ï¼Œå¯ä»¥é€šè¿‡ <code>LabelSelector</code> å®šä½åˆ°ç¯å¢ƒä¸‹çš„å”¯ä¸€èµ„æºã€‚å¯¹äºç”¨æˆ·æäº¤çš„ Flow ï¼ŒåŒä¸€ç§æ—¥å¿—è§£æã€è·¯ç”±è§„åˆ™ç±»å‹çš„èµ„æºå¯ä»¥é›†ä¸­ç®¡ç†é…ç½®ï¼Œå¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_I0IT language-yaml theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-yaml codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> logging.banzaicloud.io/v1beta1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Flow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> tenant</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">localOutputRefs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">match</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">select</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">kubegems.io/applications</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">select</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">kubegems.io/applications</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> mysql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">select</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">app.kubernetes.io/name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> tomcat</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="å±€éƒ¨æ¨¡å¼ä¸‹çš„ç”¨æˆ·æµç¨‹">å±€éƒ¨æ¨¡å¼ä¸‹çš„ç”¨æˆ·æµç¨‹<a class="hash-link" href="#å±€éƒ¨æ¨¡å¼ä¸‹çš„ç”¨æˆ·æµç¨‹" title="Direct link to heading">â€‹</a></h4><p><img loading="lazy" src="/assets/images/logging-flow-cae426711b9ce472ccdafde0a59bc330.jpg" width="488" height="494" class="img_E7b_"></p><p>å±€éƒ¨è‡ªå®šä¹‰æ¨¡å¼ä¸‹ï¼Œå¼€æ”¾æ™®é€šç”¨æˆ·é…ç½®æœ‰é™åŠŸèƒ½çš„ Flow ä»¥åŠ Outputs èµ„æºã€‚KubeGems ä»ç„¶éœ€è¦å¯¹ CR åšç®€å•æ¥å£å°è£…ã€‚å®ƒçš„è°ƒç”¨æµç¨‹å¦‚ä¸‹ï¼š</p><ol><li>åˆ›å»ºæ—¥å¿—è§„åˆ™æ—¶ï¼Œè¯·æ±‚KubeGems listWorkload è¿”å›å½“å‰ç¯å¢ƒç©ºé—´ä¸‹å…·å¤‡é‡‡é›†æ¡ä»¶ï¼ˆ CommonLabelï¼‰çš„èµ„æºåˆ—è¡¨ï¼Œç”±ç”¨æˆ·åœ¨å‰ç«¯é€‰æ‹©åŠ å…¥ã€‚</li><li>ç”¨æˆ·ç•Œé¢å†…æä¾›æ’ä»¶åˆ—è¡¨ï¼Œæœ‰ç”¨æˆ·è‡ªå®šä¹‰æ’ä»¶æ˜¯å¦å¯ç”¨</li><li>é€šè¿‡è¯·æ±‚ KubeGems listOutput è¿”å›å½“å‰ç¯å¢ƒä¸‹å¯ç”¨çš„æ—¥å¿—è·¯ç”±ã€‚æ™®é€šç”¨æˆ·åŒæ—¶ä¹Ÿå…·å¤‡åˆ—å‡º <code>ClusterOutput</code> èµ„æº(å®ƒç”±KubeGems å¹³å°ç®¡ç†å‘˜åˆ›å»º)ã€‚</li><li>æ—¥å¿—è§„åˆ™å…³è” <code>localOutputRefs</code>æˆ–è€… <code>globalOutputRefs</code>åæäº¤ç»™ KubeGems åå°æ¸²æŸ“ Flow æ–‡ä»¶ã€‚</li><li>Flow/Output èµ„æºç”± Logging Operator å¤„ç†ï¼Œå¹¶è¿”å›èµ„æºvalidateç»“æœå’ŒçŠ¶æ€ã€‚</li></ol><p><img loading="lazy" src="/assets/images/logging-timing-744eaea22364f8641ab9b5e2a334f294.jpg" width="616" height="561" class="img_E7b_"></p><p>å³åœ¨ <code>å±€éƒ¨è‡ªå®šä¹‰æ¨¡å¼</code> ä¸‹ï¼ŒKubeGems åœ¨ç§Ÿæˆ·ç©ºé—´çš„æ¥å£ä¸­ä¼ å…¥å¦‚ä¸‹å‚æ•°ï¼š</p><div class="codeBlockContainer_I0IT language-apl theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-apl codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">POST  observe/log/&lt;tenant_name&gt;/flow?name=tenant&amp;namespace=tenant&amp;monitor=true&amp;throttle=4000&amp;geoip_keys=remote_addr&amp;outputs=my-elasticsearch,my-kafka&amp;clusteroutputs=loki</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><table><thead><tr><th align="center">å‚æ•°</th><th align="center">é‡Šæ„</th><th align="center">required</th><th align="center">Type</th></tr></thead><tbody><tr><td align="center">name</td><td align="center">æ—¥å¿—é‡‡é›†è§„åˆ™åç§°</td><td align="center">True</td><td align="center">String</td></tr><tr><td align="center">namespace</td><td align="center">é‡‡é›†æ—¥å¿—çš„ç›®æ ‡å‘½åç©ºé—´</td><td align="center">True</td><td align="center">String</td></tr><tr><td align="center">monitor</td><td align="center">å¯ç”¨æ—¥å¿—é‡‡é›†çŠ¶æ€ç›‘æ§ï¼Œdefault: true</td><td align="center">False</td><td align="center">Boolean</td></tr><tr><td align="center">throttle</td><td align="center">å¯ç”¨å®¹å™¨çº§æ—¥å¿—æ¡ç›®é™é€Ÿï¼ŒLines / 10s</td><td align="center">False</td><td align="center">Int16</td></tr><tr><td align="center">geoip_keys</td><td align="center">å¯ç”¨ GEO IP</td><td align="center">False</td><td align="center">String</td></tr><tr><td align="center">outputs</td><td align="center">æ™®é€šæ—¥å¿—è¾“å‡ºé€šé“ï¼Œå¤šä¸ªé€šé“ç”¨ ,é€—å·åˆ†å‰²</td><td align="center">At laeast one</td><td align="center">String</td></tr><tr><td align="center">clusteroutputs</td><td align="center">æ—¥å¿—è¾“å‡ºé€šé“ï¼Œå¤šä¸ªé€šé“ç”¨ ,é€—å·åˆ†å‰²</td><td align="center">At laeast one</td><td align="center">String</td></tr></tbody></table><blockquote><p>outputs å’Œ clusteroutputs å‚æ•°è‡³å°‘æ»¡è¶³ä¸€ä¸ª</p></blockquote><p>KubeGems å°† Flow æ¸²æŸ“å¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_I0IT language-yaml theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-yaml codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> logging.banzaicloud.io/v1beta1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Flow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> tenant</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> tenant</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">filters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">geoip</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token key atrule" style="color:#00a4db">geoip_lookup_keys</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> remote_addr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token key atrule" style="color:#00a4db">records</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">city</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">city.names.en</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;remote_addr&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token key atrule" style="color:#00a4db">location_array</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> &#x27;&#x27;&#x27;</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">location.longitude</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;remote&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">location.latitude</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;remote&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">&#x27;&#x27;&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token key atrule" style="color:#00a4db">country</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">country.iso_code</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;remote_addr&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token key atrule" style="color:#00a4db">country_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">country.names.en</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;remote_addr&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token key atrule" style="color:#00a4db">postal_code</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">  $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">postal.code</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;remote_addr&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">record_modifier</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">records</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">throttle_group_key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">record</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;kubernetes&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;namespace_name&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">+record</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;kubernetes&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;pod_name&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">prometheus</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">container</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $.kubernetes.container_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $.kubernetes.namespace_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">node</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $.kubernetes.host</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">pod</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $.kubernetes.pod_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">metrics</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">desc</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Total number of log entries generated by either application containers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          or system components</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> logging_entry_count</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> counter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">throttle</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">group_bucket_limit</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">group_bucket_period_s</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">group_key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> throttle_group_key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">localOutputRefs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">elasticsearch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">kafka</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">globalOutputRefs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> loki</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="åŸå§‹æ¨¡å¼">åŸå§‹æ¨¡å¼<a class="hash-link" href="#åŸå§‹æ¨¡å¼" title="Direct link to heading">â€‹</a></h3><p>å¯¹äºç§Ÿæˆ·éœ€è¦ä½¿ç”¨ Logging Operator å®Œæ•´ç‰¹æ€§æ¥åšè‡ªå®šä¹‰æ—¥å¿—è§£æåœºæ™¯ï¼ŒKubeGems åªéœ€åœ¨é¡µé¢ä¸­æ»¡è¶³å¯¹ <strong>Flow åŸå§‹æ ¼å¼ </strong>çš„æ ¡éªŒå’Œæäº¤å³å¯ã€‚</p><div class="codeBlockContainer_I0IT language-api theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-api codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">POST  observe/log/&lt;tenant_name&gt;/flow?raw=true</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>Body:</p><div class="codeBlockContainer_I0IT language-yaml theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-yaml codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> logging.banzaicloud.io/v1beta1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Flow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> kafka</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">filters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">tag_normaliser</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">parser</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token key atrule" style="color:#00a4db">remove_key_name_field</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token key atrule" style="color:#00a4db">reserve_data</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token key atrule" style="color:#00a4db">parse</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> multi_format</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token key atrule" style="color:#00a4db">patterns</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">format</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">format</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> regexp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token key atrule" style="color:#00a4db">expression</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /foo/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">format</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> none</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">match</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">select</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">app.kubernetes.io/name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> log</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">generator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">localOutputRefs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> kafka</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">output</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="kubegems-log-observability">KubeGems Log Observability<a class="hash-link" href="#kubegems-log-observability" title="Direct link to heading">â€‹</a></h2><p>KubeGems çš„æ—¥å¿—å¯è§‚æµ‹æ€§ä¸»è¦æ»¡è¶³ä»¥ä¸‹å‡ ç‚¹éœ€æ±‚</p><ul><li>ç”¨æˆ·ç¯å¢ƒç©ºé—´å†…çš„æ—¥å¿—é‡‡é›†é€Ÿç‡åˆ†æ</li><li>ç”¨æˆ·ç¯å¢ƒç©ºé—´å†…çš„é”™è¯¯æ—¥å¿—ç»Ÿè®¡</li><li>ç”¨æˆ·è‡ªå®šä¹‰çš„æ—¥å¿—å‘Šè­¦è§„åˆ™</li></ul><p>é»˜è®¤æƒ…å†µä¸‹ KubeGems Logging æ’ä»¶é›†æˆäº† Loki å®ä¾‹ç”¨äºæŒä¹…åŒ–å¹³å°å†…å®¹å™¨æ—¥å¿—ã€‚å€Ÿæœ‰ Loki Rulerï¼Œå¯å®ç°æ—¥å¿—å‘Šè­¦å’Œé”™è¯¯æ—¥å¿—åˆ†æç›¸å…³åŠŸèƒ½ã€‚ </p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="æ—¥å¿—å¯è§‚æµ‹æ€§æµç¨‹">æ—¥å¿—å¯è§‚æµ‹æ€§æµç¨‹<a class="hash-link" href="#æ—¥å¿—å¯è§‚æµ‹æ€§æµç¨‹" title="Direct link to heading">â€‹</a></h3><p><img loading="lazy" src="/assets/images/logging-alert-1ed1e9044188d2bf85461db567ca20b3.jpg" width="1530" height="624" class="img_E7b_"></p><ol><li>KubeGems Installer åœ¨ Kubernetes é›†ç¾¤åˆå§‹åŒ–é˜¶æ®µè´Ÿè´£å°† Logging æ’ä»¶ä¸‹çš„ Loki å’Œ <code>Recording Rules</code> é…ç½®ã€‚</li><li>æ™®é€šç”¨æˆ·åœ¨ç”¨æˆ·ç•Œé¢ä¸­åˆ›å»ºæ—¥å¿—å‘Šè­¦è§„åˆ™ï¼Œç”± KubeGems å°†å‘Šè­¦è§„åˆ™ä»¥ Loki API æ–¹å¼æäº¤ã€‚</li><li>å½“äº§ç”ŸLoki äº§ç”Ÿæ—¥å¿—å‘Šè­¦æ—¶ï¼Œç»ç”± AlertManager å°†å‘Šè­¦äº‹ä»¶æ¨é€ç»™ç”¨æˆ·ï¼Œå¹¶åœ¨ KubeGems Webhook è®°å½•ã€‚</li></ol><p>åœ¨ä¸Šè¿°æµç¨‹ä¸­ï¼ŒKubeGems æ—¥å¿—å‘Šè­¦ä¸­ä»…éœ€æä¾› logrules æ¥å£ï¼Œç”¨äºç®¡ç†ç”¨æˆ·å‘Šè­¦å†…å®¹ã€‚</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="log-alerting-template">Log Alerting Template<a class="hash-link" href="#log-alerting-template" title="Direct link to heading">â€‹</a></h3><p>Loki çš„ Rules çš„è¯­æ³•è§„åˆ™å’Œ Prometheus ä¸€æ ·ï¼ŒåŒºåˆ«åªåœ¨<code>expr</code>ä¸­ä½“ç°ã€‚å½“å‰ KubeGems ä¸­çš„ Metrics å‘Šè­¦é‡‡ç”¨çš„æ˜¯<code>é¢„åˆ¶æ¨¡æ¿</code> çš„æ–¹å¼ï¼Œä»¥æ”¯æŒç”¨æˆ·æ›´å¿«çš„åˆ›å»ºè§„åˆ™ã€‚åœ¨æ—¥å¿—å‘Šè­¦è§„åˆ™ä¹Ÿå¯å‚è€ƒæ­¤æ–¹å¼ï¼Œé¢„åˆ¶å¸¸è§çš„ LogQL æ¨¡æ¿ã€‚</p><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="æ™®é€šæ¨¡æ¿">æ™®é€šæ¨¡æ¿<a class="hash-link" href="#æ™®é€šæ¨¡æ¿" title="Direct link to heading">â€‹</a></h4><p>æ™®é€šæ¨¡æ¿å³ç”¨æˆ·åªéœ€è¦è®¾ç½®<code>æ—¥å¿—å…³é”®å­—ç¬¦</code>ä»¥ç®¡é“çš„æ–¹å¼è¿‡æ»¤å­—ç¬¦ã€‚KubeGems åœ¨åç«¯ç»„è£…è¯­å¥ expr å¹¶è¯·æ±‚ Loki API å®Œæˆè§„åˆ™æäº¤  ã€‚æŸ¥è¯¢è¯­å¥å¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_I0IT language-yaml theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-yaml codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">sum by (pod</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">namespace</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">application) (count_over_time(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">pod=&quot;&lt;pod</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain">&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">namespace=&quot;&lt;namespace</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain">&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">applications=&quot;&lt;applications</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain">&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">~ `&lt;your_log_string</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain">`  </span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">~ `&lt;your_log_string</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain">`</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">1m</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">))</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="æ ¼å¼åŒ–æ¨¡æ¿jsonlogfmt">æ ¼å¼åŒ–æ¨¡æ¿ï¼ˆjson/logfmt)<a class="hash-link" href="#æ ¼å¼åŒ–æ¨¡æ¿jsonlogfmt" title="Direct link to heading">â€‹</a></h4><p>é‡‡ç”¨ LogQL çš„æ ¼å¼åŒ–è§£æå™¨æå–æ—¥å¿—ï¼Œé€šè¿‡æŸ¥æ‰¾ <code>key-values</code> çš„æ–¹å¼è¿‡æ»¤ç»“æœã€‚</p><ul><li>json è§£é‡Šå™¨</li></ul><div class="codeBlockContainer_I0IT language-sql theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-sql codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">sum </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pod</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">namespace</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">application</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">count_over_time</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">{pod</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;&lt;pod&gt;&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">namespace</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;&lt;namespace&gt;&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">applications</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;&lt;applications&gt;&quot;</span><span class="token plain">}  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> json </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">  </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">your_key</span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">your_string</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">   __error__</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token plain">m</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><ul><li>logfmt</li></ul><div class="codeBlockContainer_I0IT language-sql theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-sql codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain"> sum </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pod</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">namespace</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">application</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">count_over_time</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">{pod</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;&lt;pod&gt;&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">namespace</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;&lt;namespace&gt;&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">applications</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;&lt;applications&gt;&quot;</span><span class="token plain">}  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> logfmt </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">  </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">your_key</span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">your_string</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain">   __error__</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token plain">m</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="é«˜çº§æ¨¡å¼">é«˜çº§æ¨¡å¼<a class="hash-link" href="#é«˜çº§æ¨¡å¼" title="Direct link to heading">â€‹</a></h4><p>é‡‡ç”¨ LogQL åŸç”Ÿè¯­å¥ç›´æ¥æäº¤ Rulesã€‚</p><p>ä¸Šè¿° 3 ç§ LogQL é¢„åˆ¶æ¨¡æ¿ï¼Œæœ€ç»ˆæäº¤çš„æ ¼å¼åŒ– alertrules ç»“æ„å¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_I0IT language-yaml theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-yaml codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> should_fire</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">rules</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">alert</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> &lt;your_log_string</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">alert</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">expr</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sum by (pod</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">namespace</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">application) (count_over_time(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">pod=&quot;&lt;pod</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain">&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">namespace=&quot;&lt;namespace</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain">&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">applications=&quot;&lt;applications</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain">&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">~ `&lt;$your_log_string</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain">`  </span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain">~ `&lt;$your_log_string</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain">`</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">1m</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">))  </span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain">= &lt;$your_thresholds</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">for</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 1m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">severity</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> &lt;$your_severity</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">pod</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">$labels.pod</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">$labels.namespace</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">application</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">labels.applicastions</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">annotations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">summary</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">  message &lt;your_log_string</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain"> alerting </span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">now has </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">$labels.value</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="log-recording-rules">Log Recording Rules<a class="hash-link" href="#log-recording-rules" title="Direct link to heading">â€‹</a></h3><p><code>Recording Rules</code> å…è®¸ç”¨æˆ·é¢„å…ˆå°†éœ€è¦è¿›è¡Œå¤§é‡è®¡ç®—çš„è¡¨è¾¾å¼çš„ç»“æœè½¬åŒ–ä¿å­˜ä¸ºä¸€ç»„æ–°çš„æ—¶é—´åºåˆ—ï¼Œå¹¶å°†å…¶é€šè¿‡ <code>remote_write</code>çš„æ–¹å¼å†™å…¥ Prometheusã€‚åœ¨ KubeGems ä¸­ï¼Œå¹³å°å°†æ¥å…¥ <code>Logging Observability</code> çš„åº”ç”¨é¢„åˆ¶äº†é€šç”¨æ€§çš„ Error Log Rulesã€‚</p><p>ä¸  Alerting Rules ä¸€æ ·ï¼ŒRecoring Rules å¦‚è¦ Loki Ruler çš„æ”¯æŒï¼Œè¿™éƒ¨åˆ†å°†åœ¨ KubeGems Installer åˆå§‹åŒ–ä¸­éƒ¨ç½²åˆ°æ‚¨çš„é›†ç¾¤ã€‚</p><blockquote><p>å…³äº Loki Ruler å¯¹ RemoteWrite çš„é…ç½®ï¼Œå¯æŸ¥è€ƒ<a href="https://grafana.com/docs/loki/latest/rules/#remote-write" target="_blank" rel="noopener noreferrer">loki/remote-write</a></p></blockquote><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="log-metrics">Log Metrics<a class="hash-link" href="#log-metrics" title="Direct link to heading">â€‹</a></h3><p>Log Metrics åœ¨ KubeGems ä¸­ï¼Œç”±ç”¨æˆ·æäº¤çš„æ—¥å¿—é‡‡é›†å™¨ä¸­å£°æ˜ï¼Œè¿™éƒ¨åˆ†é‡‡ç”¨ <code>fluent-plugin-prometheus</code>ï¼Œæ ¸å¿ƒéƒ¨åˆ†å³ä¸ºæ¯ä¸ªè¿›å…¥ç®¡é“çš„æ—¥å¿—æµåˆ›å»ºä¸€ä¸ª <code>è®¡æ•°å™¨(Counter)</code>å¹¶è®°å½•å…¶æ¡ç›®å’Œå…ƒæ•°æ®ã€‚</p><div class="codeBlockContainer_I0IT language-yaml theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-yaml codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">prrometheus</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">container</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $.kubernetes.container_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $.kubernetes.namespace_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">node</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $.kubernetes.host</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">pod</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $.kubernetes.pod_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">metrics</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">desc</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Total number of log entries generated by either application containers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          or system components</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> logging_entry_count</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> counter</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>æœ€ç»ˆç”± Prometheus å°†æŒ‡æ ‡<code>logging_entry_count</code>æŒä¹…åŒ–åˆ°æœ¬åœ°ã€‚</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="æ€»ç»“">æ€»ç»“<a class="hash-link" href="#æ€»ç»“" title="Direct link to heading">â€‹</a></h2><p>KubeGems ä¸­åŸºäºç§Ÿæˆ·çš„æ—¥å¿—é‡‡é›†æ–¹æ¡ˆæ•´ä½“è®¾è®¡é‡‡ç”¨ Logging Operator + Loki æ¶æ„ï¼Œç”¨æˆ·å¯æ ¹æ®ä¼ä¸šè‡ªèº«ç»„ç»‡ç»“æ„å¯¹å…¶è¿›è¡Œç®¡ç†å’Œé€‚é…ã€‚å¯¹äºåœ¨ Kubernetes é›†ç¾¤ä¸­æ“ä½œåŸç”Ÿçš„ CRD èµ„æºå¤æ‚çš„åœºæ™¯ä¸‹ï¼ŒKubeGems å°½é‡è®©ç”¨æˆ·åœ¨æ¥å…¥æ—¥å¿—é‡‡é›†ã€ç›‘æ§å’Œå‘Šè­¦çš„ä¸‰ä¸ªæ–¹é¢åšåˆ°å¼€ç®±å³ç”¨çš„åŠŸèƒ½ï¼Œæå¤§ç®€åŒ–ç³»ç»Ÿç®¡ç†è€…æˆ–ç ”å‘äººå‘˜çš„æ˜¯å­¦ä¹ å’Œæ¥å…¥æˆæœ¬ã€‚</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_XVD_ padding--none margin-left--sm"><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/blog/tags/logging">logging</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/blog/tags/kubernetes">kubernetes</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/blog/tags/loki">loki</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/blog/tags/logging-operator">logging-operator</a></li><li class="tag_JSN8"><a class="tag_hD8n tagRegular_D6E_" href="/blog/tags/observability">observability</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about KubeGems ä¸­çš„æ—¥å¿—è®¾è®¡" href="/blog/kubegems-logging"><b>Read More</b></a></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></main></div></div></div><footer class="footer" id="footer"><div class="text--center">Copyright Â© 2022 KubeGems.io .</div></footer></div>
<script src="/assets/js/runtime~main.359836ee.js"></script>
<script src="/assets/js/main.d0ddff40.js"></script>
</body>
</html>